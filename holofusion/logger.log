INFO:sqlalchemy.engine.base.Engine:SHOW VARIABLES LIKE 'sql_mode'
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT DATABASE()
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:show collation where `Charset` = 'utf8' and `Collation` = 'utf8_bin'
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT CAST('test plain returns' AS CHAR(60)) AS anon_1
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT CAST('test unicode returns' AS CHAR(60)) AS anon_1
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT CAST('test collated returns' AS CHAR CHARACTER SET utf8) COLLATE utf8_bin AS anon_1
INFO:sqlalchemy.engine.base.Engine:()
INFO:__main__:Connection established to data database
INFO:__main__:ingesting file:flight-data/flight-data.csv
INFO:sqlalchemy.engine.base.Engine:INSERT INTO metatable (dataset_id,tablename,schem) VALUES('199588441795','Init','Source,Flight_Num,Scheduled_Dept,Actual_Dept,Dept_Gate,Scheduled_Arrival,Actual_Arrival,Arrival_Gate');
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:__main__:creating dataset with id:199588441795
INFO:__main__:ingest csv time: 10.3333518505

INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '199588441795' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '199588441795' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:set @p:=0;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE             199588441795_Feature_temp(var_index INT,Source_id TEXT, key_id TEXT,             attribute TEXT, source_observation TEXT, weight_id TEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                          Source AS Source_id,                                          init.Flight_Num as key_id,'Scheduled_Dept'                                            AS attribute,                                           init.Scheduled_Dept AS source_observation ,                                          ' 'AS weight_id                                          FROM 199588441795_Init AS init where init.Scheduled_Dept IS NOT NULL)as T_0);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 199588441795_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                          Source AS Source_id,                                          init.Flight_Num as key_id,'Actual_Dept'                                            AS attribute,                                           init.Actual_Dept AS source_observation ,                                          ' 'AS weight_id                                          FROM 199588441795_Init AS init where init.Actual_Dept IS NOT NULL)as T_1);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 199588441795_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                          Source AS Source_id,                                          init.Flight_Num as key_id,'Dept_Gate'                                            AS attribute,                                           init.Dept_Gate AS source_observation ,                                          ' 'AS weight_id                                          FROM 199588441795_Init AS init where init.Dept_Gate IS NOT NULL)as T_2);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 199588441795_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                          Source AS Source_id,                                          init.Flight_Num as key_id,'Scheduled_Arrival'                                            AS attribute,                                           init.Scheduled_Arrival AS source_observation ,                                          ' 'AS weight_id                                          FROM 199588441795_Init AS init where init.Scheduled_Arrival IS NOT NULL)as T_3);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 199588441795_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                          Source AS Source_id,                                          init.Flight_Num as key_id,'Actual_Arrival'                                            AS attribute,                                           init.Actual_Arrival AS source_observation ,                                          ' 'AS weight_id                                          FROM 199588441795_Init AS init where init.Actual_Arrival IS NOT NULL)as T_4);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 199588441795_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                          Source AS Source_id,                                          init.Flight_Num as key_id,'Arrival_Gate'                                            AS attribute,                                           init.Arrival_Gate AS source_observation ,                                          ' 'AS weight_id                                          FROM 199588441795_Init AS init where init.Arrival_Gate IS NOT NULL)as T_5);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 199588441795_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:__main__:adding weight_id to feature table...
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 199588441795_weight_temp(weight_id INT PRIMARY KEY AUTO_INCREMENT,Source_id LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO  199588441795_weight_temp (SELECT * FROM (SELECT distinct NULL, Source_id FROM 199588441795_Feature_temp) AS TABLE1);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE                                      199588441795_Feature(var_index INT PRIMARY KEY AUTO_INCREMENT,Source_id TEXT , rv_index TEXT,	                                   rv_attr TEXT,assigned_val   TEXT, weight_id TEXT );
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Feature (SELECT * FROM ( SELECT NULL AS var_index , table1.Source_id , table1.key_id as rv_index, table1.attribute as rv_attr , table1.source_observation as assigned_val ,  table2.weight_id FROM 199588441795_Feature_temp AS table1, 199588441795_weight_temp AS table2  WHERE table1.Source_id=table2.Source_id ) AS ftmp  order by rv_index,rv_attr );
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:__main__:adding weight_id to feature table is finished
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 199588441795_Weights AS (SELECT DISTINCT (0 + table1.weight_id) AS weight_id ,1  AS weight_val FROM 199588441795_Feature AS table1 GROUP BY table1.weight_id);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 199588441795_Feature_gb_accur AS (SELECT EXP(SUM(0+weight_val)) AS sum_probabilities,table2.rv_index, table2.rv_attr,table2.assigned_val FROM 199588441795_Weights AS table1,199588441795_Feature AS table2 WHERE table1.weight_id=table2.weight_id GROUP BY table2.rv_index,table2.rv_attr,table2.assigned_val);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 199588441795_Probabilities AS (SELECT table1.rv_index,table1.rv_attr,table1.assigned_val,table1.sum_probabilities/total_sum AS probability FROM 199588441795_Feature_gb_accur AS table1,(SELECT SUM(sum_probabilities) AS total_sum,rv_index, rv_attr FROM 199588441795_Feature_gb_accur GROUP BY rv_index,rv_attr) AS table2 WHERE table1.rv_index=table2.rv_index and table1.rv_attr=table2.rv_attr);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 199588441795_Final AS (SELECT table1.rv_index, table2.rv_attr, MAX(table2.assigned_val) AS assigned_val FROM (SELECT MAX(probability) AS max1,rv_index, rv_attr FROM 199588441795_Probabilities GROUP BY rv_index, rv_attr) AS table1 , 199588441795_Probabilities AS table2 WHERE table1.rv_index = table2.rv_index AND table1.rv_attr = table2.rv_attr AND max1 = table2.probability GROUP BY table1.rv_index,table2.rv_attr);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO metatable (dataset_id,tablename,schem) VALUES('199588441795','Correct','Flight_Num,Scheduled_Dept,Actual_Dept,Dept_Gate,Scheduled_Arrival,Actual_Arrival,Arrival_Gate');
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '199588441795' AND  tablename = 'Correct';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '199588441795' AND  tablename = 'Correct';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE                     199588441795_Correct_flat( rv_index TEXT,                     rv_attr TEXT, assigned_val TEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Correct_flat SELECT * FROM (  (SELECT                                                   init.Flight_Num as rv_index,'Scheduled_Dept'                                                    AS rv_attr,                                                   init.Scheduled_Dept AS assigned_val                                                   FROM 199588441795_Correct AS init )as T_0);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Correct_flat SELECT * FROM (  (SELECT                                                   init.Flight_Num as rv_index,'Actual_Dept'                                                    AS rv_attr,                                                   init.Actual_Dept AS assigned_val                                                   FROM 199588441795_Correct AS init )as T_1);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Correct_flat SELECT * FROM (  (SELECT                                                   init.Flight_Num as rv_index,'Dept_Gate'                                                    AS rv_attr,                                                   init.Dept_Gate AS assigned_val                                                   FROM 199588441795_Correct AS init )as T_2);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Correct_flat SELECT * FROM (  (SELECT                                                   init.Flight_Num as rv_index,'Scheduled_Arrival'                                                    AS rv_attr,                                                   init.Scheduled_Arrival AS assigned_val                                                   FROM 199588441795_Correct AS init )as T_3);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Correct_flat SELECT * FROM (  (SELECT                                                   init.Flight_Num as rv_index,'Actual_Arrival'                                                    AS rv_attr,                                                   init.Actual_Arrival AS assigned_val                                                   FROM 199588441795_Correct AS init )as T_4);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 199588441795_Correct_flat SELECT * FROM (  (SELECT                                                   init.Flight_Num as rv_index,'Arrival_Gate'                                                    AS rv_attr,                                                   init.Arrival_Gate AS assigned_val                                                   FROM 199588441795_Correct AS init )as T_5);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
