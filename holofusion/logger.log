INFO:sqlalchemy.engine.base.Engine:SHOW VARIABLES LIKE 'sql_mode'
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT DATABASE()
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:show collation where `Charset` = 'utf8' and `Collation` = 'utf8_bin'
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT CAST('test plain returns' AS CHAR(60)) AS anon_1
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT CAST('test unicode returns' AS CHAR(60)) AS anon_1
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT CAST('test collated returns' AS CHAR CHARACTER SET utf8) COLLATE utf8_bin AS anon_1
INFO:sqlalchemy.engine.base.Engine:()
INFO:__main__:Connection established to data database
<<<<<<< Updated upstream
INFO:__main__:ingesting file:data/stock-data/stock-data-test80.csv
INFO:sqlalchemy.engine.base.Engine:INSERT INTO metatable (dataset_id,tablename,schem) VALUES('993109676381','Init','index,source,date_symbol,percent_change,last');
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:__main__:creating dataset with id:993109676381
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '993109676381' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO metatable (dataset_id,tablename,schem) VALUES('993109676381','Training','date_symbol,percent_change,last');
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '993109676381' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_C_clean AS (SELECT table1.* FROM 993109676381_Init AS table1, 993109676381_Training AS table2 WHERE table1.date_symbol=table2.date_symbol and table1.percent_change=table2.percent_change and table1.last=table2.last);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_C_dk AS (SELECT table1.* FROM 993109676381_Init AS table1 LEFT JOIN 993109676381_Training AS table2 on table1.date_symbol=table2.date_symbol where table2.date_symbol is NULL);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '993109676381' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '993109676381' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:set @p:=0;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE             993109676381_Feature_temp(var_index INT,Source_id TEXT, key_id TEXT,             attribute TEXT, source_observation TEXT, weight_id TEXT, fixed INT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                                    Source AS Source_id,		                                            init.date_symbol as key_id,'percent_change'                                                      AS attribute, 		                                            init.percent_change AS source_observation ,                                                    ' 'AS weight_id, 1 AS fixed                                                    FROM 993109676381_C_clean AS init where init.percent_change IS NOT NULL)as T_0);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 993109676381_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                                 Source AS Source_id,		                                         init.date_symbol as key_id,'percent_change'                                                   AS attribute, 		                                         init.percent_change AS source_observation ,                                                 ' 'AS weight_id, 0 AS fixed                                                 FROM 993109676381_C_dk AS init where init.percent_change IS NOT NULL)as T_1);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 993109676381_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                                    Source AS Source_id,		                                            init.date_symbol as key_id,'last'                                                      AS attribute, 		                                            init.last AS source_observation ,                                                    ' 'AS weight_id, 1 AS fixed                                                    FROM 993109676381_C_clean AS init where init.last IS NOT NULL)as T_2);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 993109676381_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                                 Source AS Source_id,		                                         init.date_symbol as key_id,'last'                                                   AS attribute, 		                                         init.last AS source_observation ,                                                 ' 'AS weight_id, 0 AS fixed                                                 FROM 993109676381_C_dk AS init where init.last IS NOT NULL)as T_3);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 993109676381_Feature_temp;
=======
INFO:__main__:ingesting file:data/stock-data/stock-data-test.csv
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE metatable (dataset_id TEXT,tablename TEXT,schem TEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO metatable (dataset_id,tablename,schem) VALUES('623452822577','Init','index,source,date_symbol,percent_change,last');
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:__main__:creating dataset with id:623452822577
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '623452822577' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO metatable (dataset_id,tablename,schem) VALUES('623452822577','Training','date_symbol,percent_change,last');
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 623452822577_C_clean AS (SELECT table1.* FROM 623452822577_Init AS table1, 623452822577_Training AS table2 WHERE table1.date_symbol=table2.date_symbol and table1.percent_change=table2.percent_change);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 623452822577_C_dk AS (SELECT table1.* FROM 623452822577_Init AS table1 LEFT JOIN 623452822577_Training AS table2 on table1.date_symbol=table2.date_symbol where table2.date_symbol is NULL);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '623452822577' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '623452822577' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:set @p:=0;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE             623452822577_Feature_temp(var_index INT,Source_id TEXT, key_id TEXT,             attribute TEXT, source_observation TEXT, weight_id TEXT, fixed INT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 623452822577_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                                    Source AS Source_id,		                                            init.date_symbol as key_id,'percent_change'                                                      AS attribute, 		                                            init.percent_change AS source_observation ,                                                    ' 'AS weight_id, 1 AS fixed                                                    FROM 623452822577_C_clean AS init where init.percent_change IS NOT NULL)as T_0);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 623452822577_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 623452822577_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                                 Source AS Source_id,		                                         init.date_symbol as key_id,'percent_change'                                                   AS attribute, 		                                         init.percent_change AS source_observation ,                                                 ' 'AS weight_id, 0 AS fixed                                                 FROM 623452822577_C_dk AS init where init.percent_change IS NOT NULL)as T_1);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 623452822577_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '623452822577' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE             623452822577_Fact(RID INT,key_id TEXT,             attribute TEXT, source_observation TEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:set @p:=0;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 623452822577_Fact SELECT * FROM (  (SELECT  DISTINCT  @p := @p + 1 AS RID,        		                        init.date_symbol as key_id,'percent_change' AS attribute,         		                        init.percent_change AS source_observation                                         FROM 623452822577_C_dk AS init)  as T_0);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(RID) into @p from 623452822577_Fact;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 623452822577_Sources AS (SELECT DISTINCT date_symbol, count(source) FROM 623452822577_C_dk GROUP BY date_symbol)
>>>>>>> Stashed changes
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:__main__:adding weight_id to feature table...
<<<<<<< Updated upstream
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_weight_temp(weight_id INT PRIMARY KEY AUTO_INCREMENT, Source_id LONGTEXT, attribute LONGTEXT );
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO  993109676381_weight_temp (SELECT * FROM ( SELECT distinct NULL, Source_id, attribute FROM 993109676381_Feature_temp) AS TABLE1);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE                                      993109676381_Feature(var_index INT PRIMARY KEY AUTO_INCREMENT,Source_id TEXT , rv_index TEXT,	                                   rv_attr TEXT,assigned_val   TEXT, weight_id TEXT, fixed INT );
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Feature (SELECT * FROM ( SELECT NULL AS var_index , table1.Source_id , table1.key_id as rv_index, table1.attribute as rv_attr , table1.source_observation as assigned_val ,  table2.weight_id, table1.fixed as fixed FROM 993109676381_Feature_temp AS table1, 993109676381_weight_temp AS table2  WHERE table1.Source_id=table2.Source_id and table1.attribute=table2.attribute )AS ftmp  order by rv_index,rv_attr );
=======
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 623452822577_weight_temp(weight_id INT PRIMARY KEY AUTO_INCREMENT,Source_id LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO  623452822577_weight_temp (SELECT * FROM (SELECT distinct NULL, Source_id FROM 623452822577_Feature_temp) AS TABLE1);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE                                      623452822577_Feature(var_index INT PRIMARY KEY AUTO_INCREMENT,Source_id TEXT , rv_index TEXT,	                                   rv_attr TEXT,assigned_val   TEXT, weight_id TEXT, fixed INT );
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 623452822577_Feature (SELECT * FROM ( SELECT NULL AS var_index , table1.Source_id , table1.key_id as rv_index, table1.attribute as rv_attr , table1.source_observation as assigned_val ,  table2.weight_id, table1.fixed as fixed FROM 623452822577_Feature_temp AS table1, 623452822577_weight_temp AS table2  WHERE table1.Source_id=table2.Source_id ) AS ftmp  order by rv_index,rv_attr );
>>>>>>> Stashed changes
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:__main__:adding weight_id to feature table is finished
INFO:__main__:numbskull is starting
INFO:__main__:wrapper is starting
<<<<<<< Updated upstream
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_Possible_values AS (SELECT DISTINCT rv_index as tid,rv_attr as attr_name,assigned_val  as attr_val  FROM 993109676381_Feature);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_Variable_tmp(variable_index INT,rv_ind LONGTEXT,rv_attr LONGTEXT,is_Evidence LONGTEXT,initial_value LONGTEXT,Datatype LONGTEXT,Cardinality INT,vtf_offset TEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Variable_tmp(SELECT (@c := @c + 1) AS variable_index, table2.rv_index AS rv_ind,table2.rv_attr AS rv_attr,'0' AS is_Evidence,'0' AS initial_value,'1' AS Datatype,count1 AS Cardinality,'       ' AS vtf_offset FROM ( SELECT  rv_index , rv_attr , min(fixed) as fixed FROM 993109676381_Feature group by rv_index,rv_attr) AS table2,(SELECT count(*) AS count1,attr_name,tid FROM 993109676381_Possible_values GROUP BY attr_name,tid) AS counting,(SELECT @c:=0) m WHERE counting.attr_name=table2.rv_attr AND counting.tid=table2.rv_index and fixed=0);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Variable_tmp(SELECT (@c := @c + 1) AS variable_index, table2.rv_index AS rv_ind,table2.rv_attr AS rv_attr,'1' AS is_Evidence,assigned_val AS initial_value,'1' AS Datatype,count1 AS Cardinality,'       ' AS vtf_offset FROM ( SELECT  rv_index , rv_attr ,min(assigned_val) as assigned_val,min(fixed) as fixed FROM 993109676381_Feature group by rv_index,rv_attr ) AS table2,(SELECT count(*) AS count1,attr_name,tid FROM 993109676381_Possible_values GROUP BY attr_name,tid) AS counting WHERE counting.attr_name=table2.rv_attr AND counting.tid=table2.rv_index and table2.fixed=1 );
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_Feature_gb AS(SELECT MIN(var_index) AS smallest, rv_index, rv_attr  FROM 993109676381_Feature GROUP BY rv_index, rv_attr);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_Variable(variable_index INT PRIMARY KEY AUTO_INCREMENT,rv_ind LONGTEXT,rv_attr LONGTEXT,is_Evidence LONGTEXT,initial_value LONGTEXT,Datatype LONGTEXT,Cardinality LONGTEXT,vtf_offset LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Variable SELECT * FROM (SELECT NULL AS variable_index,table2.rv_ind as rv_ind,table2.rv_attr,table2.is_Evidence,table2.initial_value,table2.Datatype,table2.Cardinality,table1.smallest AS vtf_offset FROM  993109676381_Feature_gb AS table1 , 993109676381_Variable_tmp AS table2 WHERE table1.rv_index = table2.rv_ind AND table1.rv_attr = table2.rv_attr) AS vtmp ORDER BY vtf_offset;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_Weights AS (SELECT DISTINCT (0 + table1.weight_id) AS weight_id ,max(fixed) AS Is_fixed,max(fixed) AS init_val FROM 993109676381_Feature AS table1 GROUP BY table1.weight_id);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_Factor_to_var(factor_to_var_index INT PRIMARY KEY AUTO_INCREMENT,vid LONGTEXT,rv_ind LONGTEXT,attr_val LONGTEXT,attr_name LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Factor_to_var SELECT * FROM ((SELECT NULL AS factor_to_var_index,variable_index AS vid,rv_ind,attr_val,table1.attr_name FROM  993109676381_Possible_values AS table1,993109676381_Variable AS table2, (SELECT @n:=0) m WHERE table1.tid=rv_ind AND table1.attr_name=table2.rv_attr)) AS ftvtmp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_Factor(factor_index INT PRIMARY KEY AUTO_INCREMENT,var_index LONGTEXT,FactorFunction LONGTEXT,weightID LONGTEXT,Feature_Value LONGTEXT,arity LONGTEXT,ftv_offest LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Factor SELECT * FROM ((SELECT distinct NULL AS factor_index,var_index, '4' AS FactorFunction, table1.weight_id AS weightID, '1' AS Feature_Value, '1' AS arity, table3.factor_to_var_index AS ftv_offest FROM 993109676381_Feature AS table1,993109676381_Variable AS table2,993109676381_Factor_to_var AS table3 , (SELECT @n:=0) m WHERE table1.rv_index=table2.rv_ind AND table1.rv_attr= table2.rv_attr AND table3.vid=table2.variable_index AND table3.attr_val=table1.assigned_val )ORDER BY var_index) AS ftmp ;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:__main__:wrapper is finished
INFO:__main__:numbskull is finished
INFO:sqlalchemy.engine.base.Engine:drop table 993109676381_Weights;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO metatable (dataset_id,tablename,schem) VALUES('993109676381','Weights','weight_id,weight_val');
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:__main__:adding weight is finished
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_Feature_gb_accur AS (SELECT EXP(SUM(0+weight_val)) AS sum_probabilities,table2.rv_index, table2.rv_attr,table2.assigned_val FROM 993109676381_Weights AS table1,993109676381_Feature AS table2 WHERE table1.weight_id=table2.weight_id GROUP BY table2.rv_index,table2.rv_attr,table2.assigned_val);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_Probabilities AS (SELECT table1.rv_index,table1.rv_attr,table1.assigned_val,table1.sum_probabilities/total_sum AS probability FROM 993109676381_Feature_gb_accur AS table1,(SELECT SUM(sum_probabilities) AS total_sum,rv_index, rv_attr FROM 993109676381_Feature_gb_accur GROUP BY rv_index,rv_attr) AS table2 WHERE table1.rv_index=table2.rv_index and table1.rv_attr=table2.rv_attr);
=======
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 623452822577_Possible_values AS (SELECT DISTINCT rv_index as tid,rv_attr as attr_name,assigned_val  as attr_val  FROM 623452822577_Feature);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 623452822577_Variable_tmp(variable_index INT,rv_ind LONGTEXT,rv_attr LONGTEXT,is_Evidence LONGTEXT,initial_value LONGTEXT,Datatype LONGTEXT,Cardinality INT,vtf_offset TEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 623452822577_Variable_tmp(SELECT (@c := @c + 1) AS variable_index, table2.rv_index AS rv_ind,table2.rv_attr AS rv_attr,'0' AS is_Evidence,'0' AS initial_value,'1' AS Datatype,count1 AS Cardinality,'       ' AS vtf_offset FROM ( SELECT  rv_index , rv_attr , min(fixed) as fixed FROM 623452822577_Feature group by rv_index,rv_attr) AS table2,(SELECT count(*) AS count1,attr_name,tid FROM 623452822577_Possible_values GROUP BY attr_name,tid) AS counting,(SELECT @c:=0) m WHERE counting.attr_name=table2.rv_attr AND counting.tid=table2.rv_index and fixed=0);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 623452822577_Variable_tmp(SELECT (@c := @c + 1) AS variable_index, table2.rv_index AS rv_ind,table2.rv_attr AS rv_attr,'1' AS is_Evidence,assigned_val AS initial_value,'1' AS Datatype,count1 AS Cardinality,'       ' AS vtf_offset FROM ( SELECT  rv_index , rv_attr ,min(assigned_val) as assigned_val,min(fixed) as fixed FROM 623452822577_Feature group by rv_index,rv_attr ) AS table2,(SELECT count(*) AS count1,attr_name,tid FROM 623452822577_Possible_values GROUP BY attr_name,tid) AS counting WHERE counting.attr_name=table2.rv_attr AND counting.tid=table2.rv_index and table2.fixed=1 );
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 623452822577_Feature_gb AS(SELECT MIN(var_index) AS smallest, rv_index, rv_attr  FROM 623452822577_Feature GROUP BY rv_index, rv_attr);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 623452822577_Variable(variable_index INT PRIMARY KEY AUTO_INCREMENT,rv_ind LONGTEXT,rv_attr LONGTEXT,is_Evidence LONGTEXT,initial_value LONGTEXT,Datatype LONGTEXT,Cardinality LONGTEXT,vtf_offset LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 623452822577_Variable SELECT * FROM (SELECT NULL AS variable_index,table2.rv_ind as rv_ind,table2.rv_attr,table2.is_Evidence,table2.initial_value,table2.Datatype,table2.Cardinality,table1.smallest AS vtf_offset FROM  623452822577_Feature_gb AS table1 , 623452822577_Variable_tmp AS table2 WHERE table1.rv_index = table2.rv_ind AND table1.rv_attr = table2.rv_attr) AS vtmp ORDER BY vtf_offset;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 623452822577_Weights AS (SELECT DISTINCT (0 + table1.weight_id) AS weight_id ,max(fixed) AS Is_fixed,max(fixed) AS init_val FROM 623452822577_Feature AS table1 GROUP BY table1.weight_id);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 623452822577_Factor_to_var(factor_to_var_index INT PRIMARY KEY AUTO_INCREMENT,vid LONGTEXT,rv_ind LONGTEXT,attr_val LONGTEXT,attr_name LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 623452822577_Factor_to_var SELECT * FROM ((SELECT NULL AS factor_to_var_index,variable_index AS vid,rv_ind,attr_val,table1.attr_name FROM  623452822577_Possible_values AS table1,623452822577_Variable AS table2, (SELECT @n:=0) m WHERE table1.tid=rv_ind AND table1.attr_name=table2.rv_attr)) AS ftvtmp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 623452822577_Factor(factor_index INT PRIMARY KEY AUTO_INCREMENT,var_index LONGTEXT,FactorFunction LONGTEXT,weightID LONGTEXT,Feature_Value LONGTEXT,arity LONGTEXT,ftv_offest LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 623452822577_Factor SELECT * FROM ((SELECT distinct NULL AS factor_index,var_index, '4' AS FactorFunction, table1.weight_id AS weightID, '1' AS Feature_Value, '1' AS arity, table3.factor_to_var_index AS ftv_offest FROM 623452822577_Feature AS table1,623452822577_Variable AS table2,623452822577_Factor_to_var AS table3 , (SELECT @n:=0) m WHERE table1.rv_index=table2.rv_ind AND table1.rv_attr= table2.rv_attr AND table3.vid=table2.variable_index AND table3.attr_val=table1.assigned_val )ORDER BY var_index) AS ftmp ;
>>>>>>> Stashed changes
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 993109676381_Final AS (SELECT table1.rv_index, table2.rv_attr, MAX(table2.assigned_val) AS assigned_val FROM (SELECT MAX(probability) AS max1,rv_index, rv_attr FROM 993109676381_Probabilities GROUP BY rv_index, rv_attr) AS table1 , 993109676381_Probabilities AS table2 WHERE table1.rv_index = table2.rv_index AND table1.rv_attr = table2.rv_attr AND max1 = table2.probability GROUP BY table1.rv_index,table2.rv_attr);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO metatable (dataset_id,tablename,schem) VALUES('993109676381','Correct','date_symbol,percent_change,last');
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '993109676381' AND  tablename = 'Correct';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '993109676381' AND  tablename = 'Correct';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE                     993109676381_Correct_flat( rv_index TEXT,                     rv_attr TEXT, assigned_val TEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Correct_flat SELECT * FROM (  (SELECT                                                   table1.date_symbol as rv_index,'percent_change'                                                    AS rv_attr,                                                   table1.percent_change AS assigned_val                                                   FROM 993109676381_Correct AS table1,993109676381_Final AS table2 where table1.date_symbol=table2.rv_index)as T_0);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 993109676381_Correct_flat SELECT * FROM (  (SELECT                                                   table1.date_symbol as rv_index,'last'                                                    AS rv_attr,                                                   table1.last AS assigned_val                                                   FROM 993109676381_Correct AS table1,993109676381_Final AS table2 where table1.date_symbol=table2.rv_index)as T_1);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
