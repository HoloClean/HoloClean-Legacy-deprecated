INFO:sqlalchemy.engine.base.Engine:SHOW VARIABLES LIKE 'sql_mode'
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT DATABASE()
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:show collation where `Charset` = 'utf8' and `Collation` = 'utf8_bin'
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT CAST('test plain returns' AS CHAR(60)) AS anon_1
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT CAST('test unicode returns' AS CHAR(60)) AS anon_1
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT CAST('test collated returns' AS CHAR CHARACTER SET utf8) COLLATE utf8_bin AS anon_1
INFO:sqlalchemy.engine.base.Engine:()
INFO:__main__:Connection established to data database
INFO:__main__:ingesting file:book-data/book.csv
INFO:sqlalchemy.engine.base.Engine:INSERT INTO metatable (dataset_id,tablename,schem) VALUES('254436570144','Init','Index,Source,ISBN,Title,Author_list');
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:__main__:creating dataset with id:254436570144
INFO:__main__:ingest csv time: 13.3633811474

INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '254436570144' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:SELECT schem FROM metatable Where dataset_id = '254436570144' AND  tablename = 'Init';
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:set @p:=0;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE             254436570144_Feature_temp(var_index INT,Source_id TEXT, key_id TEXT,             attribute TEXT, source_observation TEXT, weight_id TEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 254436570144_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                          Source AS Source_id,                                          init.ISBN as key_id,'Title'                                            AS attribute,                                           init.Title AS source_observation ,                                          ' 'AS weight_id                                          FROM 254436570144_Init AS init )as T_0);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 254436570144_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 254436570144_Feature_temp SELECT * FROM (  (SELECT  @p := @p + 1 AS var_index,                                          Source AS Source_id,                                          init.ISBN as key_id,'Author_list'                                            AS attribute,                                           init.Author_list AS source_observation ,                                          ' 'AS weight_id                                          FROM 254436570144_Init AS init )as T_1);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:select max(var_index) into @p from 254436570144_Feature_temp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:__main__:adding weight_id to feature table...
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 254436570144_weight_temp(weight_id INT PRIMARY KEY AUTO_INCREMENT,Source_id LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO  254436570144_weight_temp (SELECT * FROM (SELECT distinct NULL, Source_id FROM 254436570144_Feature_temp) AS TABLE1);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE                                      254436570144_Feature(var_index INT PRIMARY KEY AUTO_INCREMENT,Source_id TEXT , key_id TEXT,	                                   attribute TEXT, source_observation TEXT, weight_id TEXT );
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 254436570144_Feature (SELECT * FROM ( SELECT NULL AS var_index , table1.Source_id , table1.key_id, table1.attribute , table1.source_observation ,  table2.weight_id FROM 254436570144_Feature_temp AS table1, 254436570144_weight_temp AS table2  WHERE table1.Source_id=table2.Source_id ) AS ftmp  order by key_id,attribute );
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:__main__:adding weight_id to feature table is finished
INFO:__main__:wrapper is starting
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 254436570144_Possible_values AS (SELECT DISTINCT key_id,attribute,source_observation  FROM 254436570144_Feature);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 254436570144_Variable_tmp(variable_index INT,key_id LONGTEXT,attribute LONGTEXT,is_Evidence LONGTEXT,initial_value LONGTEXT,Datatype LONGTEXT,Cardinality INT,vtf_offset TEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 254436570144_Variable_tmp(SELECT (@c := @c + 1) AS variable_index, table2.key_id AS key_id,table2.attribute AS attribute,'0' AS is_Evidence,'0' AS initial_value,'1' AS Datatype,count1 AS Cardinality,'       ' AS vtf_offset FROM (select key_id,attribute from 254436570144_Feature group by key_id,attribute) AS table2,(SELECT count(*) AS count1,attribute,key_id FROM 254436570144_Possible_values GROUP BY key_id,attribute) AS counting,(SELECT @c:=0) m WHERE counting.attribute=table2.attribute AND counting.key_id=table2.key_id);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 254436570144_Feature_gb AS(SELECT MIN(var_index) AS smallest, key_id,attribute  FROM 254436570144_Feature GROUP BY key_id,attribute );
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 254436570144_Variable(variable_index INT PRIMARY KEY AUTO_INCREMENT,key_id LONGTEXT,attribute LONGTEXT,is_Evidence LONGTEXT,initial_value LONGTEXT,Datatype LONGTEXT,Cardinality LONGTEXT,vtf_offset LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 254436570144_Variable SELECT * FROM (SELECT NULL AS variable_index,table2.key_id,table2.attribute,table2.is_Evidence,table2.initial_value,table2.Datatype,table2.Cardinality,table1.smallest AS vtf_offset FROM  254436570144_Feature_gb AS table1 , 254436570144_Variable_tmp AS table2 WHERE table1.key_id = table2.key_id AND table1.attribute = table2.attribute) AS vtmp ORDER BY vtf_offset;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 254436570144_Weights AS (SELECT DISTINCT (0 + table1.weight_id) AS weight_id ,0 AS Is_fixed,0  AS init_val FROM 254436570144_Feature AS table1 GROUP BY table1.weight_id);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 254436570144_Factor_to_var(factor_to_var_index INT PRIMARY KEY AUTO_INCREMENT,vid LONGTEXT,key_id LONGTEXT,attr_val LONGTEXT,attribute LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 254436570144_Factor_to_var SELECT * FROM ((SELECT NULL AS factor_to_var_index,variable_index AS vid,table1.key_id,source_observation,table1.attribute FROM  254436570144_Possible_values AS table1,254436570144_Variable AS table2, (SELECT @n:=0) m WHERE table1.key_id=table2.key_id AND table1.attribute=table2.attribute)) AS ftvtmp;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:CREATE TABLE 254436570144_Factor(factor_index INT PRIMARY KEY AUTO_INCREMENT,var_index LONGTEXT,FactorFunction LONGTEXT,weightID LONGTEXT,Feature_Value LONGTEXT,arity LONGTEXT,ftv_offest LONGTEXT);
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:COMMIT
INFO:sqlalchemy.engine.base.Engine:INSERT INTO 254436570144_Factor SELECT * FROM ((SELECT distinct NULL AS factor_index,var_index, '4' AS FactorFunction, table1.weight_id AS weightID, '1' AS Feature_Value, '1' AS arity, table3.factor_to_var_index AS ftv_offest FROM 254436570144_Feature AS table1,254436570144_Variable AS table2,254436570144_Factor_to_var AS table3 , (SELECT @n:=0) m WHERE table1.key_id=table2.key_id AND table1.attribute= table2.attribute AND table3.vid=table2.variable_index AND table3.source_observation=table1.source_observation )ORDER BY var_index) AS ftmp ;
INFO:sqlalchemy.engine.base.Engine:()
INFO:sqlalchemy.engine.base.Engine:ROLLBACK
